# CloudTrailとDynamoDB暗号化の月額コスト見積もり

## 1. CloudTrailによる監査ログ

### AWS CloudTrailの料金体系（2024年）

#### 基本料金
- **管理イベントの記録**: **最初のコピーは無料**
- **データイベントの記録**: $0.10 / 100,000イベント
- **CloudTrail Insights**: $0.35 / 100,000イベント（オプション）

#### ログストレージ
- **S3への保存**: S3の標準料金が適用（約$0.023/GB/月）
- **CloudWatch Logsへの保存**: $0.50 / GB（取り込み）+ $0.03 / GB（保存）

### このプロジェクトでの見積もり

#### 前提条件
- DynamoDB操作: 1日あたり約10,000回（GetItem, Query, PutItem等）
- 月間: 約300,000回のDynamoDB操作
- 管理イベント: Lambda実行、IAM操作等を含めて月間約500,000イベント

#### コスト計算

**シナリオ1: 最小構成（管理イベントのみ記録）**
```
- 管理イベントの記録: 無料（最初のコピー）
- S3ストレージ: 約0.5GB/月 × $0.023/GB = $0.01
- 合計: 約 $0.01/月（ほぼ無料）
```

**シナリオ2: 標準構成（データイベントも記録）**
```
- 管理イベント: 無料
- データイベント（DynamoDB）: 300,000イベント ÷ 100,000 × $0.10 = $0.30
- S3ストレージ: 約2GB/月 × $0.023/GB = $0.05
- 合計: 約 $0.35/月
```

**シナリオ3: 完全構成（CloudTrail Insights含む）**
```
- 管理イベント: 無料
- データイベント: $0.30
- CloudTrail Insights: 500,000イベント ÷ 100,000 × $0.35 = $1.75
- S3ストレージ: 約2GB/月 × $0.023/GB = $0.05
- 合計: 約 $2.10/月
```

### 推奨構成とコスト

| 構成 | 月額コスト | 説明 |
|------|-----------|------|
| **最小構成** | **$0.01** | 管理イベントのみ（無料枠内） |
| **標準構成** | **$0.35** | データイベントも記録（推奨） |
| **完全構成** | **$2.10** | CloudTrail Insights含む |

**推奨**: **標準構成（$0.35/月）**
- DynamoDBのすべての操作を記録
- セキュリティ監査に十分
- コスト効率が良い

---

## 2. DynamoDB暗号化の強化（AWS KMS）

### AWS KMSの料金体系（2024年）

#### 基本料金
- **カスタマーマネージドキー（CMK）**: **$1.00 / 月 / キー**
- **AWS管理キー**: **無料**（DynamoDBのデフォルト暗号化）

#### 暗号化/復号化リクエスト
- **10,000リクエストあたり**: $0.03
- **最初の20,000リクエスト/月**: 無料（AWS管理キーの場合）

### このプロジェクトでの見積もり

#### 前提条件
- DynamoDB操作: 1日あたり約10,000回
- 月間: 約300,000回のDynamoDB操作
- 暗号化/復号化が必要な操作: GetItem, PutItem, UpdateItem, Query等

#### コスト計算

**シナリオ1: AWS管理キー（推奨）**
```
- キー管理料: 無料
- 暗号化/復号化リクエスト: 
  - 最初の20,000リクエスト: 無料
  - 残り280,000リクエスト: 280,000 ÷ 10,000 × $0.03 = $0.84
- 合計: 約 $0.84/月
```

**シナリオ2: カスタマーマネージドキー（CMK）**
```
- キー管理料: $1.00/月
- 暗号化/復号化リクエスト: 300,000 ÷ 10,000 × $0.03 = $0.90
- 合計: 約 $1.90/月
```

### 推奨構成とコスト

| 構成 | 月額コスト | 説明 |
|------|-----------|------|
| **AWS管理キー** | **$0.84** | デフォルト暗号化（推奨） |
| **カスタマーマネージドキー** | **$1.90** | より細かい制御が必要な場合 |

**推奨**: **AWS管理キー（$0.84/月）**
- コスト効率が良い
- キー管理が不要
- ほとんどの用途で十分

---

## 合計コスト見積もり

### 推奨構成での合計

| 項目 | 月額コスト |
|------|-----------|
| **CloudTrail（標準構成）** | $0.35 |
| **DynamoDB暗号化（AWS管理キー）** | $0.84 |
| **合計** | **$1.19/月** |

### 完全構成での合計

| 項目 | 月額コスト |
|------|-----------|
| **CloudTrail（完全構成）** | $2.10 |
| **DynamoDB暗号化（CMK）** | $1.90 |
| **合計** | **$4.00/月** |

---

## コスト変動要因

### CloudTrailのコストが増加する場合
- **DynamoDB操作が増加**: 1日10,000回 → 100,000回の場合、約$3.00/月
- **CloudTrail Insightsを使用**: 約$2.00/月追加
- **ログ保存期間が長い**: S3ストレージコストが増加

### KMSのコストが増加する場合
- **DynamoDB操作が増加**: 1日10,000回 → 100,000回の場合、約$8.40/月
- **複数のKMSキーを使用**: キー1つあたり$1.00/月追加
- **カスタマーマネージドキーを使用**: 約$1.00/月追加

---

## 実用的な見積もり

### 小規模運用（月間100,000操作）
- CloudTrail: $0.10/月
- KMS: $0.30/月
- **合計: $0.40/月**

### 中規模運用（月間300,000操作）← **このプロジェクト**
- CloudTrail: $0.35/月
- KMS: $0.84/月
- **合計: $1.19/月**

### 大規模運用（月間1,000,000操作）
- CloudTrail: $1.00/月
- KMS: $2.70/月
- **合計: $3.70/月**

---

## コスト最適化のヒント

### CloudTrail
1. **ログの保存期間を短縮**: 90日間保存で十分な場合が多い
2. **S3ライフサイクルポリシー**: 古いログをGlacierに移行
3. **CloudTrail Insightsは必要時のみ**: 通常は標準構成で十分

### KMS
1. **AWS管理キーを使用**: カスタマーマネージドキーは必要な場合のみ
2. **キーの統合**: 複数のテーブルで同じキーを使用
3. **リクエスト数の監視**: 不要な操作を削減

---

## まとめ

### 推奨実装コスト（このプロジェクト）

| 項目 | 月額コスト |
|------|-----------|
| CloudTrail（標準構成） | **$0.35** |
| DynamoDB暗号化（AWS管理キー） | **$0.84** |
| **合計** | **約$1.20/月** |

**年間コスト**: 約$14.40/年

このコストで、以下のセキュリティ強化が実現できます：
- ✅ すべてのDynamoDB操作の監査ログ
- ✅ データの保存時暗号化
- ✅ セキュリティインシデントの早期発見
- ✅ コンプライアンス要件の満たし

---

## 参考リンク

- [AWS CloudTrail 料金](https://aws.amazon.com/jp/cloudtrail/pricing/)
- [AWS KMS 料金](https://aws.amazon.com/jp/kms/pricing/)
- [DynamoDB 暗号化](https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/encryption.how-it-works.html)

